name: AutoTests (manual)

on:
  workflow_dispatch:
    inputs:
      spec_glob:
        description: "Optional spec glob (e.g. cypress/e2e/platformTests/**/*.cy.js)"
        required: false
        default: ""

jobs:
  run-cypress:
    runs-on: ubuntu-latest

    env:
      # Settings > Secrets and variables > Actions
      CYPRESS_USER_EMAIL: ${{ secrets.CYPRESS_USER_EMAIL }}
      CYPRESS_USER_PASSWORD: ${{ secrets.CYPRESS_USER_PASSWORD }}
      CYPRESS_USER_NAME: ${{ secrets.CYPRESS_USER_NAME }}

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Setup Node
        uses: actions/setup-node@v4
        with:
          node-version: 22
          cache: npm

      - name: Install deps
        run: npm ci

      - name: Run Cypress (manual spec or all)
        env:
          SPEC_GLOB: ${{ github.event.inputs.spec_glob }}
        run: |
          SPECS="${SPEC_GLOB:-cypress/e2e/**/*.cy.js}"
          echo "Running specs: $SPECS"
          npx cypress run --browser chrome --headless --spec "$SPECS"
